@model LecturerClaimSystem.Models.Claim

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-5">
    <h2>Submit a Claim (Lecturer)</h2>

    <!--Success Message-->
    @if (TempData["SuccessMessage"] != null)
    {
        <script>
            alert('@TempData["SuccessMessage"]');
            window.location.href = '@Url.Action("MakeAClaim", "Lecturer")';
        </script>
    }

    <!--Error Message-->
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    <form asp-action="MakeAClaim"
          asp-controller="Lecturer"
          method="post"
          enctype="multipart/form-data"
          class="mt-4">

        @Html.AntiForgeryToken()

        <!--Lecturer ID-->
        <div class="form-group mb-3">
            <label asp-for="LecturerId" class="form-label">Lecturer ID</label>
            <input asp-for="LecturerId" class="form-control" placeholder="Enter your Lecturer ID" />
            <span asp-validation-for="LecturerId" class="text-danger"></span>
        </div>

        <!--Month-->
        <div class="form-group mb-3">
            <label asp-for="Month" class="form-label">Month</label>
            <input asp-for="Month" class="form-control" type="month" />
            <span asp-validation-for="Month" class="text-danger"></span>
        </div>

        <!--Hours Worked-->
        <div class="form-group mb-3">
            <label asp-for="HoursWorked" class="form-label">Hours Worked</label>
            <input asp-for="HoursWorked" class="form-control" type="number" min="0" />
            <span asp-validation-for="HoursWorked" class="text-danger"></span>
        </div>

        <!--Hourly Rate-->
        <div class="form-group mb-3">
            <label asp-for="HourlyRate" class="form-label">Hourly Rate</label>
            <input asp-for="HourlyRate" class="form-control" type="number" step="0.01" min="0" />
            <span asp-validation-for="HourlyRate" class="text-danger"></span>
        </div>

        <!--Description-->
        <div class="form-group mb-3">
            <label asp-for="Description" class="form-label">Description</label>
            <textarea asp-for="Description" class="form-control" rows="3" placeholder="Brief description of the claim"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        <!--File Upload-->
        <div class="form-group mb-3">
            <label class="form-label">Supporting Document (PDF, DOCX, XLSX)</label>
            <input type="file"
                   name="SupportingDocument"
                   id="SupportingDocument"
                   class="form-control"
                   accept=".pdf,.docx,.xlsx" />
            <small id="fileNameDisplay" class="text-muted"></small>
        </div>
        
        <!--Total amount-->
        <div class="form-group mb-3">
            <label>Total Amount</label>
            <input type="text" id="totalAmount" class="form-control" readonly />
        </div>

        <button type="submit" class="btn btn-primary">Submit Claim</button>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.getElementById("SupportingDocument").addEventListener("change", function () {
            const file = this.files[0];
            if (file) {
                document.getElementById("fileNameDisplay").innerText = "Uploaded: " + file.name;
            } else {
                document.getElementById("fileNameDisplay").innerText = "";
            }
        });

        const hoursInput = document.getElementById("HoursWorked");
        const rateInput = document.getElementById("HourlyRate");
        const totalAmountInput = document.getElementById("totalAmount");

        function calculateTotal() {
            const hours = parseFloat(hoursInput.value) || 0;
            const rate = parseFloat(rateInput.value) || 0;
            totalAmountInput.value = (hours * rate).toFixed(2);
        }

        hoursInput.addEventListener("input", calculateTotal);
        rateInput.addEventListener("input", calculateTotal);
    </script>
}
